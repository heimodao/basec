---
layout: post
title: "计算机网络"
categories: TCP/IP
tags: 计算机网络 TCP/IP
author: linkzw
---

* content
{:toc}



## 简介

网络组成：拓扑结构、链路、网络节点、网络协议、传输介质、网卡、集线器、ISO/OSI模型 节点通讯：交换技术、虚电路与数据报、交换机、路由技术 

链路通讯：通讯方式、信号分析与信道特性、数字信号编码、多路复用技术、可靠传输、流量控制 

局域网：局域网基本特点、以太网技术、无线局域网、交换式局域网、高速以太网、 TCP/IP体系结构：TCP/IP协议栈、IP协议、网络接口层相关协议、IP路由、TCP/UDP协议
	
	帧同步
	Client/Server
	UDP
	TCP

底层有丢包、重包、乱序的条件下设计出可靠的网络协议
既能充分利用带宽，又能做到足够公平（并发连接大致平均分享带宽）

	OSI体系结构 	TCP/IP体系结构		五层体系结构
	 应用层				
	 表示层				应用层				应用层
	 会话层
	 运输层				运输层				传输层
	 网络层				网际层 				网络层
	 数据链路层			网络接口层			数据链路层
	 物理层									物理层




TCP 传输控制协议 	提供面向连接、可靠的数据传输服务，数据单位为报文段；
UDP 用户数据报协议 	提供无连接、尽最大努力的数据传输服务，数据单位为用户数据报。

Tcp 是流，Udp 是包


## TCP

* 序号 ：用于对字节流进行编号，例如序号为 301，表示第一个字节的编号为 301，如果携带的数据长度为 100 字节，那么下一个报文段的序号应为 401。

* 确认号 ：期望收到的下一个报文段的序号。例如 B 正确收到 A 发送来的一个报文段，序号为 501，携带的数据长度为 200 字节，因此 B 期望下一个报文段的序号为 701，B 发送给 A 的确认报文段中确认号就为 701。

* 数据偏移 ：指的是数据部分距离报文段起始处的偏移量，实际上指的是首部的长度。

* 确认 ACK ：当 ACK=1 时确认号字段有效，否则无效。TCP 规定，在连接建立后所有传送的报文段都必须把 ACK 置 1。

* 同步 SYN ：在连接建立时用来同步序号。当 SYN=1，ACK=0 时表示这是一个连接请求报文段。若对方同意建立连接，则响应报文中 SYN=1，ACK=1。

* 终止 FIN ：用来释放一个连接，当 FIN=1 时，表示此报文段的发送方的数据已发送完毕，并要求释放运输连接。

* 窗口 ：窗口值作为接收方让发送方设置其发送窗口的依据。之所以要有这个限制，是因为接收方的数据缓存空间是有限的。


### TCP三次握手

假设 A 为客户端，B 为服务器端。

首先 B 处于 LISTEN（监听）状态，等待客户的连接请求。
	1).A 向 B 发送连接请求报文段，SYN=1，ACK=0，选择一个初始的序号 x。
	2).B 收到连接请求报文段，如果同意建立连接，则向 A 发送连接确认报文段，SYN=1，ACK=1，确认号为 x+1，同时也选择一个初始的序号 y。
	3).A 收到 B 的连接确认报文段后，还要向 B 发出确认，确认号为 y+1，序号为 x+1。
B 收到 A 的确认后，连接建立。


### TCP四次挥手

以下描述不讨论序号和确认号，因为序号和确认号的规则比较简单。并且不讨论 ACK，因为 ACK 在连接建立之后都为 1。

	1).A 发送连接释放报文段，FIN=1；
	2).B 收到之后发出确认，此时 TCP 属于半关闭状态，B 能向 A 发送数据但是 A 不能向 B 发送数据；
	3).当 B 要不再需要连接时，发送连接释放请求报文段，FIN=1；
	4).A 收到后发出确认，此时连接释放。

#### TIME_WAIT

客户端接收到服务器端的 FIN 报文后进入此状态，此时并不是直接进入 CLOSED 状态，还需要等待一个时间计时器设置的时间。这么做有两个理由：

	1).确保最后一个确认报文段能够到达。如果 B 没收到 A 发送来的确认报文段，那么就会重新发送连接释放请求报文段，A 等待一段时间就是为了处理这种情况的发生。
	2).可能存在“已失效的连接请求报文段”，为了防止这种报文段出现在本次连接之外，需要等待一段时间。

### TCP特性

TCP 使用超时重传来实现可靠传输：如果一个已经发送的报文段在超时时间内没有收到确认，那么就重传这个报文段。

TCP 流量控制
流量控制是为了控制发送方发送速率，保证接收方来得及接收。

接收方发送的确认报文中的窗口字段可以用来控制发送方窗口大小，从而影响发送方的发送速率。例如将窗口字段设置为 0，则发送方不能发送数据。

TCP拥塞控制
如果网络出现拥塞，分组将会丢失，此时发送方会继续重传，从而导致网络拥塞程度更高。因此当出现拥塞时，应当控制发送方的速率。这一点和流量控制很像，但是出发点不同。流量控制是为了让接收方能来得及接受，而拥塞控制是为了降低整个网络的拥塞程度。
 
TCP 主要通过四种算法来进行拥塞控制：慢开始、拥塞避免、快重传、快恢复。发送方需要维护有一个叫做拥塞窗口（cwnd）的状态变量。注意拥塞窗口与发送方窗口的区别，拥塞窗口只是一个状态变量，实际决定发送方能发送多少数据的是发送方窗口。



### Web 页面请求过程

1).向 DNS 服务器发送 DNS 查询报文来解析域名。

2).开始进行 HTTP 会话，需要先建立 TCP 连接。

3).在运输层的传输过程中，HTTP 报文被封装进 TCP 中。HTTP 请求报文使用端口号 80，因为服务器监听的是 80 端口。连接建立之后，服务器会随机分配一个端口号给特定的客户端，之后的 TCP 传输都是用这个分配的端口号。

4).在网络层的传输过程中，TCP 报文段会被封装进 IP 分组中，IP 分组经过路由选择，最后到达目的地。

5).在链路层，IP 分组会被封装进 MAC 帧中，IP 地址解析成 MAC 地址需要使用 ARP。

6).客户端发送 HTTP 请求报文，请求获取页面。

7).服务器发送 HTTP 相应报文，客户端从而获取该页面。

8).浏览器得到页面内容之后，解析并渲染，向用户展示页面。

常用端口
应用层协议			端口号		运输层协议
DNS					53			UDP
FTP	控制连接 21，数据连接 20	TCP
TELNET				23			TCP
DHCP				67 68		UDP
HTTP				80			TCP
SMTP				25			TCP
POP3				110			TCP
IMAP				143


## TCP滑动窗口机制

## TCP拥塞控制机制


## socket模型

- [socket阻塞](https://blog.csdn.net/hguisu/article/details/7453390)

## HTTP 状态码

服务器返回的响应报文中第一行为状态行，包含了状态码以及原因短语，来告知客户端请求的结果。

状态码	类别	原因短语
1XX	Informational（信息性状态码）	接收的请求正在处理
2XX	Success（成功状态码）	请求正常处理完毕
3XX	Redirection（重定向状态码）	需要进行附加操作以完成请求
4XX	Client Error（客户端错误状态码）	服务器无法处理请求
5XX	Server Error（服务器错误状态码）	服务器处理请求出错